{
  "$schema": "https://raw.githubusercontent.com/node-pulse/playbooks/refs/heads/main/schemas/node-pulse-admiral-playbook-manifest-v1.schema.json",
  "id": "pb_PgRstPgWeb",
  "name": "PostgreSQL Stack (PostgreSQL + PostgREST + pgweb + Nginx)",
  "version": "1.5.5",
  "description": "Complete PostgreSQL service stack with PostgreSQL 17, PostgREST RESTful API with JWT authentication, pgweb web UI protected by Authelia 2FA, and Nginx reverse proxy with path-based routing and automatic SSL. Installs to /opt/pgstack.",
  "author": {
    "name": "Yumin",
    "email": "yuminops@gmail.com",
    "url": "https://github.com/guiyumin",
    "status": "community"
  },
  "homepage": "https://github.com/node-pulse/playbooks/tree/main/catalog/p/pgsql-pgrest-pgweb-nginx",
  "repository": "https://github.com/node-pulse/playbooks",
  "category": "database",
  "tags": [
    "postgresql",
    "database",
    "api",
    "postgrest",
    "pgweb",
    "authelia",
    "2fa",
    "rest-api",
    "nginx"
  ],
  "structure": {
    "playbooks": {
      "install": {
        "file": "install.yml",
        "variables": ["domain", "admin_email", "authelia_admin_password"]
      },
      "uninstall": {
        "file": "uninstall.yml",
        "variables": ["domain"]
      },
      "update": {
        "file": "update.yml",
        "variables": ["domain"]
      }
    },
    "templates": [
      "templates/compose.yml.j2",
      "templates/env.j2",
      "templates/postgrest.conf.j2",
      "templates/init-postgrest.sql.j2",
      "templates/auth-service.py.j2",
      "templates/auth-requirements.txt.j2",
      "templates/Dockerfile.auth.j2",
      "templates/authelia-config.yml.j2",
      "templates/authelia-users.yml.j2",
      "templates/nginx-https-postgresql-stack.conf.j2"
    ],
    "files": []
  },
  "ansible_version": ">=2.10",
  "os_support": [
    { "distro": "ubuntu", "version": "20.04", "arch": "both" },
    { "distro": "ubuntu", "version": "22.04", "arch": "both" },
    { "distro": "ubuntu", "version": "24.04", "arch": "both" },
    { "distro": "debian", "version": "11", "arch": "both" },
    { "distro": "debian", "version": "12", "arch": "both" },
    { "distro": "rhel", "version": "8", "arch": "both" },
    { "distro": "rhel", "version": "9", "arch": "both" },
    { "distro": "rocky", "version": "8", "arch": "both" },
    { "distro": "rocky", "version": "9", "arch": "both" },
    { "distro": "alma", "version": "8", "arch": "both" },
    { "distro": "alma", "version": "9", "arch": "both" }
  ],
  "variables": [
    {
      "name": "domain",
      "label": "Domain Name",
      "type": "string",
      "description": "Domain for PostgreSQL Stack. Services available at /pgweb, /postgrest, /auth, /authelia",
      "required": true,
      "pattern": "^[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?(\\.[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$"
    },
    {
      "name": "admin_email",
      "label": "Admin Email",
      "type": "string",
      "description": "Email for SSL certificates and Authelia login username",
      "required": true,
      "pattern": "^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$"
    },
    {
      "name": "authelia_admin_password",
      "label": "Authelia Admin Password",
      "type": "password",
      "description": "Password for Authelia admin user (username: admin). Minimum 8 characters required.",
      "required": true
    },
    {
      "name": "api_user_name",
      "label": "API User Name",
      "type": "string",
      "description": "Username for standard API access with read/write permissions (default: api_user)",
      "required": false,
      "default": "api_user",
      "pattern": "^[a-z][a-z0-9_]{2,29}$"
    },
    {
      "name": "api_admin_name",
      "label": "API Admin Name",
      "type": "string",
      "description": "Username for admin API access with full permissions (default: api_admin)",
      "required": false,
      "default": "api_admin",
      "pattern": "^[a-z][a-z0-9_]{2,29}$"
    }
  ],
  "health_checks": [
    { "type": "tcp", "port": 5432, "timeout": 10 },
    { "type": "tcp", "port": 3000, "timeout": 10 },
    { "type": "tcp", "port": 8081, "timeout": 10 },
    {
      "type": "command",
      "command": "docker ps | grep -q pgstack-db",
      "timeout": 5
    },
    {
      "type": "command",
      "command": "docker ps | grep -q pgstack-postgrest",
      "timeout": 5
    },
    {
      "type": "command",
      "command": "docker ps | grep -q pgstack-pgweb",
      "timeout": 5
    },
    {
      "type": "command",
      "command": "docker ps | grep -q pgstack-authelia",
      "timeout": 5
    },
    { "type": "command", "command": "systemctl is-active nginx", "timeout": 5 }
  ],
  "dangerous_operations": [
    "Installs Docker if not present",
    "Creates PostgreSQL 17 database in /opt/pgstack/data",
    "Exposes PostgreSQL on localhost:5432 only",
    "Deploys PostgREST API, pgweb UI, and Authelia 2FA",
    "Installs/configures Nginx as reverse proxy",
    "Obtains SSL certificate from Let's Encrypt"
  ],
  "license": "MIT",
  "created_at": "2025-11-19T00:00:00Z",
  "updated_at": "2025-11-24T00:00:00Z"
}
