# PostgreSQL Configuration
POSTGRES_USER={{ postgres_user }}
POSTGRES_PASSWORD={{ postgres_password }}
POSTGRES_DB={{ postgres_db }}

# N8N Database Connection
DB_TYPE=postgresdb
DB_POSTGRESDB_HOST=pg
DB_POSTGRESDB_PORT=5432
DB_POSTGRESDB_DATABASE={{ postgres_db }}
DB_POSTGRESDB_USER={{ postgres_user }}
DB_POSTGRESDB_PASSWORD={{ postgres_password }}

# N8N Host & Protocol
N8N_PORT=5678
GENERIC_TIMEZONE={{ n8n_timezone }}
N8N_LISTEN_ADDRESS=0.0.0.0
{% if n8n_domain != "" %}
N8N_HOST={{ n8n_domain }}
N8N_PROTOCOL={{ 'https' if enable_ssl else 'http' }}
DOMAIN_NAME={{ n8n_domain.split('.')[-2:] | join('.') }}
SUBDOMAIN={{ n8n_domain.split('.')[0] }}
{% else %}
N8N_HOST={{ ansible_default_ipv4.address }}
N8N_PROTOCOL=http
{% endif %}

# Webhooks & Access
WEBHOOK_URL={{ n8n_webhook_url }}
N8N_EDITOR_BASE_URL={{ n8n_webhook_url }}
NODE_ENV=production

# Security
N8N_ENCRYPTION_KEY={{ n8n_encryption_key }}
N8N_USER_MANAGEMENT_JWT_SECRET={{ n8n_jwt_secret }}
N8N_SECURE_COOKIE={{ 'true' if enable_ssl else 'false' }}
N8N_USER_MANAGEMENT_DISABLED=false
{% if n8n_basic_auth_user != "" and n8n_basic_auth_password != "" %}
N8N_BASIC_AUTH_ACTIVE=true
N8N_BASIC_AUTH_USER={{ n8n_basic_auth_user }}
N8N_BASIC_AUTH_PASSWORD={{ n8n_basic_auth_password }}
{% endif %}

# Logging
N8N_LOG_LEVEL=info
N8N_LOG_FORMAT=json
N8N_LOG_OUTPUT=console

# Execution Settings
EXECUTIONS_TIMEOUT=600
N8N_RUNNERS_TASK_TIMEOUT=600
EXECUTIONS_DATA_PRUNE=true
EXECUTIONS_DATA_MAX_AGE=168
