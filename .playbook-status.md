# Node Pulse Playbooks - Status

**Created**: 2025-11-07
**Repository**: `/Users/yumin/ventures/node-pulse-stack/playbooks`

## Repository Structure

```
playbooks/
├── README.md                    # Main repository documentation
├── CONTRIBUTING.md              # Contribution guidelines
├── LICENSE                      # MIT License
└── f/
    └── fail2ban/               # First playbook (Security)
        ├── manifest.json       # Manifest v1.0 format
        ├── playbook.yml        # Main Ansible playbook
        ├── README.md           # Playbook documentation
        └── templates/
            ├── jail.local.j2   # Fail2Ban main config template
            └── sshd.local.j2   # SSH jail config template
```

## Completed Playbooks

### 1. Fail2Ban (f/fail2ban) ✅

**Status**: Ready for installation
**Category**: Security
**Version**: 1.0.0

**Features**:
- Protects SSH from brute-force attacks
- Configurable ban time, find time, max retry
- Email notifications support
- Custom SSH port support
- 6 configurable variables with UI labels

**OS Support**:
- Ubuntu 20.04, 22.04, 24.04 (both amd64/arm64)
- Debian 11, 12 (both amd64/arm64)

**Variables**:
1. `bantime` - Ban duration (default: 3600s = 1 hour)
2. `findtime` - Time window for counting attempts (default: 600s = 10 min)
3. `maxretry` - Max failed attempts (default: 5)
4. `ssh_port` - SSH port to monitor (default: 22)
5. `destemail` - Notification email (default: root@localhost)
6. `action` - Ban action type (default: action_)

**Manifest Format**: ✅ New v1.0 format
- Uses array format for variables with `name` + `label`
- Flattened `ansible_version` field
- Granular `os_support` with distro+version+arch
- Author status badge: `verified`
- Explicit `password` type support (not used in this playbook)

## Next Steps

### For Testing (Local):

```bash
cd /Users/yumin/ventures/node-pulse-stack/playbooks/f/fail2ban

# Test with Ansible (if installed)
ansible-playbook playbook.yml -i localhost, --connection=local --check

# Or deploy to a server
ansible-playbook playbook.yml -i inventory.ini
```

### For Admiral Integration:

1. **Push to GitHub** (if creating public repo):
   ```bash
   cd /Users/yumin/ventures/node-pulse-stack/playbooks
   git init
   git add .
   git commit -m "feat: initial commit with fail2ban playbook"
   git remote add origin https://github.com/node-pulse/playbooks.git
   git push -u origin main
   ```

2. **Test Sync Job**:
   - Run the Go sync job to pull playbooks into `admiral.community_playbooks` table
   - Verify manifest parsing works correctly

3. **Test Installation**:
   - Browse to "Playbooks → Community" in Admiral
   - Search for "fail2ban"
   - Click "Install"
   - Verify variable form renders correctly with labels
   - Execute playbook on a test server

## Validation Checklist

- ✅ `manifest.json` is valid JSON
- ✅ All required fields present
- ✅ `id` matches directory name (`fail2ban`)
- ✅ Entry point exists (`playbook.yml`)
- ✅ Variables use new array format with `name` + `label`
- ✅ OS support uses granular format
- ✅ Author status set to `verified`
- ✅ No `requirements.yml` file (self-contained)
- ✅ Templates exist and use Jinja2
- ✅ README documentation complete
- ⚠️  YAML syntax check (requires Ansible installation)
- ⚠️  ansible-lint (requires Ansible installation)

## Files Created

**Repository Level**:
- `/playbooks/README.md` (574 lines)
- `/playbooks/CONTRIBUTING.md` (323 lines)
- `/playbooks/LICENSE` (MIT)

**Fail2Ban Playbook**:
- `/playbooks/f/fail2ban/manifest.json` (125 lines)
- `/playbooks/f/fail2ban/playbook.yml` (75 lines)
- `/playbooks/f/fail2ban/README.md` (143 lines)
- `/playbooks/f/fail2ban/templates/jail.local.j2` (40 lines)
- `/playbooks/f/fail2ban/templates/sshd.local.j2` (25 lines)

**Total**: 8 files ready for deployment
